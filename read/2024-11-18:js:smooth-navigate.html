<!DOCTYPE html ><html lang="zh"><head> <link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/styles/default.min.css"/><script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script><link rel="stylesheet" href="/files/post-fix.css"/><link rel="icon" href="/files/icon.svg"/><meta charset="utf-8"/><meta name="viewport" content="width:device-width,initial-scale=1.0"/><meta name="author" content="0xarch"/><meta name="description" content="
简单的JS无缝跳转的实现.

兼容性未测试!
"/><meta name="keywords" content="Web JavaScript"/><meta http-equiv="content-language" content="zh-CN"/><link rel="stylesheet" href="/files/components/KContentTable.css"/><script src="/files/es/KContentTable.js"></script><link rel="stylesheet" href="/files/components/KNextPage.css"/><link rel="stylesheet" href="/files/Components/Neo/Basic/style.css"/><script src="/files/Components/Neo/Basic/script.js"></script><link rel="stylesheet" href="/files/Components/Neo/NavigationBar/style.css"/><link rel="stylesheet" href="/files/Components/Neo/Footer/style.css"/><title>WebJS - 滚动目录实现 :: 文章</title></head><body class="colorful" OCP="OVERRIDE" style="--color1:#5e8c59;--color2:#71175a"><header class="Neo NavigationBar"><a class="smooth-navigated kLogo" href="/">0xarch 的博客</a><div class="toggle"><svg viewBox="0 0 48 48" fill="none" height="48" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="48" xmlns="http://www.w3.org/2000/svg"><path d="M10,14h24M10,24h28M10,34h28"></path></svg></div><div class="kCon"><a class="smooth-navigated" href="/">首页</a><a class="smooth-navigated" href="/archive/1">归档</a><a class="smooth-navigated" href="/category/1">分类</a><a class="smooth-navigated" href="/tag/1">标签</a><a class="smooth-navigated" href="/about/">关于</a><a class="smooth-navigated" href="/status/">状态 </a><a href="/tools/">工具</a><a href="/demos/">Demo</a><link rel="stylesheet" href="/files/Components/Neo/SearchComp/style.css"/><script type="module" src="/files/Components/Neo/SearchComp/script.js"></script><div class="Neo SearchComp"><a class="openPanel">搜索</a><div class="URL">/searchStrings.json</div></div></div><dialog class="Neo SearchComp_Panel"><div class="searchBar flex jcc"><input class="--I"/><div class="--S">搜索</div><div class="--C">×</div></div><hr/><div class="--P"></div></dialog></header><div class="PageLabel uWcon"><br/><b class="meta"><date>2024年11月18日星期一</date><span>Web</span><span>350字</span></b></div><main class="uWcon"><section><h2>前言</h2><p>简单的JS无缝跳转的实现.</p><p>兼容性未测试!</p></section><article id="markdown_fillContent"><h1 id="webjs---滚动目录实现">WebJS - 滚动目录实现</h1><h2 id="js代码">JS代码</h2><pre><code class="language-js">(function (window, undefined) {
    const usedLocation = [window.location.href];
    window.onpopstate = function(){
        if(usedLocation.includes(window.location.href)){
            window.Reload.goTo(window.location.href);
        }
    };
    const DOMParserI = new DOMParser();
    window.Reload = {
        goTo: async function (url) {
            let content = await (await fetch(url)).text();
            let newDocument = DOMParserI.parseFromString(content, &#39;text/html&#39;);
            // set url
            window.history.pushState(&#39;&#39;, &#39;&#39;, url);
            !usedLocation.includes(url) &amp;&amp; usedLocation.push(url);
            // process head.
            let newTitle = newDocument.head.querySelector(&#39;title&#39;).innerHTML;
            let scripts = [], styles = [], metas = [], links = [];
            let unusedNodes = [];
            for (let childNode of newDocument.head.childNodes) {
                if (childNode.nodeType !== 1) continue;
                switch (childNode.nodeName) {
                    case &#39;META&#39;:
                        if (!childNode.name || !childNode.content) break;
                        metas.push({
                            name: childNode.name,
                            content: childNode.content
                        });
                        break;
                    case &#39;STYLE&#39;:
                        styles.push(childNode.innerHTML);
                        break;
                    case &#39;SCRIPT&#39;:
                        if (childNode.src) {
                            scripts.push({
                                type: &#39;ref&#39;,
                                module: childNode.type,
                                content: childNode.getAttribute(&#39;src&#39;)
                            });
                        } else {
                            scripts.push({
                                type: &#39;inner&#39;,
                                module: childNode.type,
                                content: childNode.innerHTML
                            });
                        }
                        break;
                    case &#39;LINK&#39;:
                        links.push({
                            rel: childNode.rel,
                            href: childNode.getAttribute(&#39;href&#39;)
                        })
                        break;
                }
            }
            for (let childNode of document.head.childNodes) {
                if (childNode.nodeType !== 1) continue;
                outer: switch (childNode.nodeName) {
                    case &#39;TITLE&#39;:
                        childNode.textContent = newTitle;
                        break;
                    case &#39;STYLE&#39;:
                        for (let i = 0; i &lt; styles.length; i++) {
                            if (childNode.innerHTML == styles[i]) {
                                styles.splice(i, 1);
                                break outer;
                            }
                        }
                        unusedNodes.push(childNode);
                        break;
                    case &#39;LINK&#39;:
                        for (let i = 0; i &lt; links.length; i++) {
                            if (childNode.rel == links[i].rel &amp;&amp; childNode.href == links[i].href) {
                                styles.splice(i, 1);
                                break outer;
                            }
                        }
                        unusedNodes.push(childNode);
                        break;
                    case &#39;SCRIPT&#39;:
                        if (!childNode.src) {
                            for (let i = 0; i &lt; scripts.length; i++) {
                                if (scripts[i].type !== &#39;inner&#39;) continue;
                                if (childNode.type == scripts[i].module &amp;&amp; childNode.innerHTML == scripts[i].content) {
                                    scripts.splice(i, 1);
                                    break outer;
                                }
                            }
                        } else {
                            for (let i = 0; i &lt; scripts.length; i++) {
                                if (scripts[i].type !== &#39;ref&#39;) continue;
                                if (childNode.type == scripts[i].module &amp;&amp; childNode.getAttribute(&#39;src&#39;) == scripts[i].content) {
                                    scripts.splice(i, 1);
                                    break outer;
                                }
                            }
                        }
                        unusedNodes.push(childNode);
                        break;
                    case &#39;META&#39;:
                        if (!childNode.name || !childNode.content) break;
                        for (let i = 0; i &lt; metas.length; i++) {
                            if (childNode.name == metas[i].name &amp;&amp; childNode.content == metas[i].content) {
                                metas.splice(i, 1);
                                break outer;
                            }
                        }
                        unusedNodes.push(childNode);
                        break;
                }
            }
            metas.forEach(v =&gt; {
                let el = document.createElement(&#39;meta&#39;);
                el.name = v.name;
                el.content = v.content;
                document.head.appendChild(el);
            });
            links.forEach(v =&gt; {
                let el = document.createElement(&#39;link&#39;);
                el.rel = v.rel;
                el.href = v.href;
                document.head.appendChild(el);
            });
            styles.forEach(v =&gt; {
                let el = document.createElement(&#39;style&#39;);
                el.innerHTML = v;
                document.head.appendChild(el);
            });
            scripts.forEach(v =&gt; {
                let el = document.createElement(&#39;script&#39;);
                if (v.type == &#39;ref&#39;) {
                    el.type = v.module;
                    el.src = v.content;
                } else {
                    el.type = v.module;
                    el.innerHTML = v.content;
                }
                document.head.appendChild(el);
            });
            unusedNodes.forEach(el =&gt; el.remove());
            // process body
            document.body = newDocument.body;
            // scroll pos
            setTimeout(()=&gt;{
                window.scrollTo(0,0);
            },0);
            DoOthers();
        }
    };
})(window, void 0);
</code></pre><h2 id="需要内容">需要内容</h2><h3 id="doothers">DoOthers</h3><p>需要提供一个全局的 <code>DoOthers</code> 函数，将在页面替换完毕后调用。</p><h2 id="提供内容">提供内容</h2><p>在 <code>window</code> 上挂了一个全局对象 <code>Reload</code>，具有一个函数 <code>Reload.goTo</code>，使用时传入一个 <code>string</code>，格式为 URL。</p></article><hr/><div class="fit cclogo"><a href="https://creativecommons.org/">传播许可协议</a><div class="inner"><b>Creative Commons </b><span>BY</span><span>ND</span><span>SA</span></div></div><br/><div class="KNextPage"><a class="arrow left nowrap disabled">← 已是最新</a><a class="arrow right nowrap" href="/read/2024-11-17:linux:arch-usb-install.html">在 USB Disk 上安装 ArchLinux 需要的 GRUB 命令 →</a><a class="top" href="#">Top</a></div></main><footer class="Neo Footer uWcon"><div class="kLinks"><nav><h3>Fewu</h3><span>Fewu Generator</span><span>1.2.4</span><a href="https://github.com/0xarch/fewu">Source Code</a></nav><nav><h3>Neo</h3><span>1.0.0</span><a href="https://github.com/0xarch/fewu-theme-neo">Github</a><a href="https://github.com/0xarch/fewu-theme-simplus">Simplus</a></nav><nav><h3>Contact</h3><a href="https://0xarch.github.io">Github Page</a><a href="https://matrix.to/#/#solo_esta_vez:mozilla.org">[Matrix] Moz</a><a href="https://matrix.to/#/#solo_esta_vez:fedora.im">[Matrix] Fedora</a><a href="mailto:alanqa-ops@outlook.com">E-Mail</a></nav><nav><h3>Friends</h3><a href="https://wangyuzhen666.github.io">Wyz666</a></nav></div><br/><hr/><div class="kCopyr tac">2024 Proudly powered by Fewu with Neo theme. 2020-2024 0xarch,soloev All rights reserved.</div></footer><div class="KContentTable"><div class="kTOC"></div><br/><button class="kButton">TOC</button></div></body></html>